<!doctype HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="EN">
<!-- ABENSELECT_HIERARCHY_ANCS_AGG -->

<!-- Mirrored from help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenselect_hierarchy_ancs_agg.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 Feb 2024 14:51:51 GMT -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="author" content="SAP">
<meta name="description" content="SELECT - FROM HIERARCHY_ANCESTORS_AGGREGATE">
<title>
SELECT - FROM HIERARCHY_ANCESTORS_AGGREGATE - ABAP Keyword Documentation
</title>
<link rel="icon" href="ABAPIcon.ico" type="image/ico">
<link rel="shortcut icon" href="ABAPIcon.ico">
<LINK rel="stylesheet" href="abap_docu.css" type="text/css">
<script language="javascript" type="text/javascript" src="functions.js"></script>
<script type="text/JavaScript">
function urlToClipboard(id){
 try{ var loc = top.location.href;}
 catch(e){ alert( "URL cannnot be determined" ); return; }
 var field = document.getElementById(id);
 field.focus();
 if ( loc.search( ".htm" ) == -1 && loc.search( ".HTM" ) == -1  ){ loc = loc + "index.htm"; }
 if (   loc.search( "index.html" ) != -1
     || loc.search( "INDEX-2.html" ) != -1 ){
   var off = loc.search( "file=" );
   if ( off == -1  ){
     field.value = loc + "?file=abenselect_hierarchy_ancs_agg.htm"; }
   else {
     field.value = loc.substring( 0, off ) + "file=abenselect_hierarchy_ancs_agg.htm";
   }
 }
 else {
    field.value = loc; }
 field.setSelectionRange(0, field.value.length);
 var r = confirm( "Copy URL to clipboard?\n\n" + field.value + "\n\nCopy to clipboard does not work in all browsers." );
 if (r == true) {
   try{
     document.execCommand("copy");
   }
     catch(e){ alert( "URL could not be copied to clipboard" ); }
 }
 window.scrollTo(0,0);
}
</script>
</head>
<body>
<div class="all">
<div style="float:right;">
<input type="button" value="URL"
style="font-size:10px; width:30px; height:18px; padding:0; "
onclick="urlToClipboard('url')" title="Copy URL to Clipboard" ></div>
<p>
<input name="query" id="query" value="" type="text" title="Suchbegriff" size="30" maxlength="30" onkeyup="getInput()">&nbsp;
<input type="button" value="Search"
style="font-size:12px; width:50px; height:18px; padding:0"
onclick="call_search('search.html')" title="Search in ABAP Keyword Documentation" >
<hr style="width:100%;height:1px"></p>
<p class="copyright">AS ABAP Release 754, &copy;Copyright 2019 SAP SE. All rights reserved.</p>
<span class="path">
<a href="javascript:call_link('abenabap.html')" class="blue">ABAP Keyword Documentation</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_reference.html')" class="blue">ABAP &#x2212; Reference</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_language_external_data.html')" class="blue">Processing External Data</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_sql.html')" class="blue">ABAP Database Access</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenopensql.html')" class="blue">ABAP SQL</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenopen_sql_reading.html')" class="blue">ABAP SQL - Reads</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenselect_clauses.html')" class="blue">SELECT clauses</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abapfrom_clause.html')" class="blue">SELECT - FROM</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abapselect_data_source.html')" class="blue">SELECT - FROM data_source</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenselect_hierarchy_data.html')" class="blue">SELECT - FROM hierarchy_data</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenselect_hierarchy_navigators.html')" class="blue">SELECT - FROM hierarchy_navigator</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenselect_hierarchy_agg_navis.html')" class="blue">SELECT - FROM hierarchy_aggregate_navigator</a>&nbsp;&rarr;&nbsp;
</span>
<A NAME="@@HIERARCHY_ANCESTORS_AGGREGATE@@!ABAP_OSQL_TABLE_FUNC!@@"></A>
<A NAME="@@SOURCE@@HIERARCHY_ANCESTORS_AGGREGATE@@"></A>
<A NAME="@@WHERE@@HIERARCHY_ANCESTORS_AGGREGATE@@"></A>
<A NAME="@@START WHERE@@HIERARCHY_ANCESTORS_AGGREGATE@@"></A>
<A NAME="@@MEASURES@@HIERARCHY_ANCESTORS_AGGREGATE@@"></A>
<p><span class="h1">
SELECT - FROM HIERARCHY_ANCESTORS_AGGREGATE
</span></p>
<A name="@@ITOC@@ABENSELECT_HIERARCHY_ANCS_AGG_1"></A>
<p><span class="h2">
Syntax
</span></p>
<p>
<span class="qtext">... HIERARCHY_ANCESTORS_AGGREGATE( <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SOURCE
<a href="javascript:call_link('abenselect_hierarchy.html')" class="blue">hierarchy</a> <i class=bn>[</i>AS tabalias<i class=bn>]</i> <br>
&nbsp;&nbsp;&nbsp;&nbsp; <i class=bn>[</i>START WHERE <a href="javascript:call_link('abenosql_expr_logexp.html')" class="blue">sql_cond</a><i class=bn>]</i> <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MEASURES agg_func1 AS alias1<i class=bn>[</i>, <br>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; agg_func2 AS alias2<i class=bn>[</i>, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<i class=bn>]</i><i class=bn>]</i> <br>
&nbsp;&nbsp;&nbsp;&nbsp; <i class=bn>[</i>WHERE <a href="javascript:call_link('abenosql_expr_logexp.html')" class="blue">sql_cond</a><i class=bn>]</i> ...</span> <br><br>
</p>
<p><span class="h3">
Extras:
</span></p>
<P>
   <A HREF="#!ABAP_ADDITION_1@1@" class="blue"> 1. <span class="qtext">... START WHERE sql_cond</span> </A> <br>
<br><A HREF="#!ABAP_ADDITION_2@2@" class="blue"> 2. <span class="qtext">... WHERE sql_cond</span> </A> <br><br>
</P>
<p><span class="h4">
Effect
</span></p>
<p>
Specifies the <a href="javascript:call_link('abenhierarchy_agg_navi_glosry.html')" class="grey" title="Glossary Entry">hierarchy
aggregate navigator</a> <span class="qtext">HIERARCHY_ANCESTORS_AGGREGATE</span> as a data source <a href="javascript:call_link('abapselect_data_source.html')" class="blue"><span class="qtext">data_source</span></a> in a ABAP SQL
<a href="javascript:call_link('abenquery_glosry.html')" class="grey" title="Glossary Entry">query</a>. It accesses the
<a href="javascript:call_link('abenhierarchy_glosry.html')" class="grey" title="Glossary Entry">hierarchy</a> <a href="javascript:call_link('abenselect_hierarchy.html')" class="blue">
<span class="qtext">hierarchy</span></a> specified after <span class="qtext">SOURCE</span> and evaluates
it. After the hierarchy, <span class="qtext">AS</span> can be used to specify an alias name for it. This name is valid within parentheses and must be used in positions in which the hierarchy is addressed.
</p>
<P>
The hierarchy navigator <span class="qtext">HIERARCHY_ANCESTORS_AGGREGATE</span> aggregates the values of all
<a href="javascript:call_link('abenancestor_node_glosry.html')" class="grey" title="Glossary Entry">ancestor nodes</a> located between
<a href="javascript:call_link('abenhierarchy_node_glosry.html')" class="grey" title="Glossary Entry">hierarchy nodes</a> determined using <span class="qtext">WHERE</span> and
<a href="javascript:call_link('abenstarting_node_glosry.html')" class="grey" title="Glossary Entry">starting nodes</a> determined
using <span class="qtext">START WHERE</span>, including the values of the hierarchy nodes and starting nodes themselves. A tabular results set is created consisting of all hierarchy nodes that
</P>
<ul class="disc">
<li>
meet the <span class="qtext">WHERE</span> condition and
<br><br></li>
<li>
have an ancestor node (including the hierarchy node itself) that meets the <span class="qtext">START WHERE</span> condition as a starting node.
<br><br></li>
<li>
Here, a separate row is created for each possible path to every starting node that occurs under the
ancestor nodes. If no <span class="qtext">WHERE</span> condition is specified, this is done for all the hierarchy nodes. If no <span class="qtext">START WHERE</span> condition is specified, the starting node is, implicitly, the
<a href="javascript:call_link('abenancestor_node_glosry.html')" class="grey" title="Glossary Entry">ancestor node</a> with the lowest <a href="javascript:call_link('abenhierarchy_level_glosry.html')" class="grey" title="Glossary Entry">hierarchy level</a>.
<br></li>
</ul>
<P>
For each node of the result, the aggregate functions specified after <span class="qtext">MEASURES</span>
are applied to the hierarchy nodes of that path that consists of the node and its ancestor nodes (including
the starting node). The aggregation is based on the starting node, which is significant for the aggregate
function <span class="qtext">STRING_AGG</span>. The result of each aggregate function is saved in the current node as the content of a separate column.
</P>
<p>
A comma-separated list of <a href="javascript:call_link('abenaggregate_function_glosry.html')" class="grey" title="Glossary Entry">aggregate
functions</a> <span class="qtext">agg_func1</span>, <span class="qtext">agg_func2</span>, ... must be
specified after <span class="qtext">MEASURES</span>. At least one aggregate function must be specified.
Each aggregate function must be assigned an alias name <span class="qtext">alias1</span>, <span class="qtext">alias2</span>,
... The arguments of the aggregate functions can be individual columns <a href="javascript:call_link('abenopen_sql_columns.html')" class="blue"><span class="qtext">col</span></a> of the hierarchy <span class="qtext">hierarchy</span>, including their
<a href="javascript:call_link('abenddddl_hierarchy.html')" class="blue">hierarchy columns</a>. The
<a href="javascript:call_link('abentable_comp_selector_glosry.html')" class="grey" title="Glossary Entry">column selector</a>
<span class="qtext">~</span> can be used to prefix the columns with the name of the hierarchy. The following aggregate functions can be used:
</p>
<p>
<a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">MIN( col )</span></a>, <br><a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">MAX( col )</span></a>, <br>
<a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">SUM( col )</span></a>, <br><a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">PRODUCT( col )</span></a>, <br>
<a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">COUNT( <i class=bn>[</i>DISTINCT<i class=bn>]</i> col )</span></a>, <br>
<a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">COUNT( * )</span></a>, <a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">COUNT(*)</span></a>, <br>
<a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">STRING_AGG( col<i class=bn>[</i>, sep<i class=bn>]</i> )</span></a>
</p>
<p>
The addition <span class="qtext">DISTINCT</span> is only possible for <span class="qtext">COUNT</span>.
The aggregate function <span class="qtext">PRODUCT</span> can be used in this hierarchy navigator only.
The addition <span class="qtext">ORDER BY</span> is not possible in the function <span class="qtext">STRING_AGG</span>.
</p>
<p>
The aggregate functions work as specified in the <a href="javascript:call_link('abensql_agg_func.html')" class="blue">general
description</a>, except that only columns <span class="qtext">col</span> are allowed as arguments and
that the result of the function <span class="qtext">COUNT</span> is INT8 instead of INT4. For each aggregate
function, a column with the alias name defined by <span class="qtext">AS</span> is added to the tabular result of the hierarchy navigator. This column contains the result of the aggregate function in every row. These columns are not
<a href="javascript:call_link('abenddddl_hierarchy.html')" class="blue">hierarchy columns</a>. If <span class="qtext">*</span>
or <span class="qtext">...~*</span> is specified in the <a href="javascript:call_link('abapselect_list.html')" class="blue"><span class="qtext">
SELECT</span> list</a>, they are read like a column of the hierarchy specified as a source and are part
of a structure or internal table created using an inline declaration <span class="qtext">@DATA(...)</span> in the <a href="javascript:call_link('abapinto_clause.html')" class="blue"><span class="qtext">INTO</span> clause</a>.
</p>
<p><span class="h4">
Notes
</span></p>
<ul class="disc">
<li>If the <span class="qtext">START WHERE</span> condition selects multiple starting nodes, a separate
row is inserted in the results set for each starting node for which a path exists to one of the hierarchy
nodes selected by the <span class="qtext">WHERE</span> condition. Child nodes with multiple parent nodes can also point to different paths to a starting node and hence to multiple rows for a hierarchy node.</li>
</ul>
<ul class="disc">
<li>Additional hierarchy columns such as START_RANK and START_ID are not yet available in the
<a href="javascript:call_link('abenhierarchy_node_navi_glosry.html')" class="grey" title="Glossary Entry">hierarchy node navigators</a>,
which means that the different paths in the results set cannot be distinguished from the content of
hierarchy columns. It is currently advisable, therefore, to use the <span class="qtext">START WHERE</span> condition to select precisely one starting node only.</li>
</ul>
<ul class="disc">
<li>The fact that the starting node determined by <span class="qtext">START WHERE</span> is respected
in the aggregation can be unwanted behavior and should be covered by the condition. This can be done,
for example, by setting a condition for the hierarchy column that determines the parent node and is not set on the key of the node.</li>
</ul>
<ul class="disc">
<li>If the hierarchy navigator <span class="qtext">HIERARCHY_ANCESTORS_AGGREGATE</span> is used, the syntax check is made in <a href="javascript:call_link('abenopensql_strict_mode_754.html')" class="blue">strict mode from Release 7.54</a>.</li>
</ul>
<p><span class="h4">
Executable Example
</span></p>
<P>
See <a href="javascript:call_link('abenhier_ancs_agg_abexa.html')" class="blue">Hierarchy Navigator <span class="qtext">HIERARCHY_ANCESTORS_AGGREGATE</span></a> <br><br>
</P>
<p><span class="h3">
<A NAME="!ABAP_ADDITION_1@1@"></A> <span class="bold">Addition 1</span>
</span></p>
<P>
<span class="qtext">... START WHERE sql_cond</span>   <br><!-- /A -->
</P>
<p><span class="h4">
Effect
</span></p>
<p>
The <span class="qtext">START WHERE</span> condition selects the starting nodes for the paths in question
for the hierarchy nodes selected by the <span class="qtext">WHERE</span> condition. Columns of the hierarchy, including the additional
<a href="javascript:call_link('abenddddl_hierarchy.html')" class="blue">hierarchy columns</a>, can be used in the condition <a href="javascript:call_link('abenosql_expr_logexp.html')" class="blue"><span class="qtext">sql_cond</span></a>.
</p>
<p>
If a selected starting node is an ancestor node of a node selected by <span class="qtext">WHERE</span>, the latter is added to the results set.
</p>
<p><span class="h4">
Notes
</span></p>
<ul class="disc">
<li>
If multiple starting nodes are ancestor nodes of a node selected by <span class="qtext">WHERE</span>, the latter is also added to the results set multiple times.
<br><br></li>
<li>
If a selected starting node is not an ancestor node of a node selected by <span class="qtext">WHERE</span>, the node is ignored. <br><br>
<br></li>
</ul>
<p><span class="h3">
<A NAME="!ABAP_ADDITION_2@2@"></A> <span class="bold">Addition 2</span>
</span></p>
<P>
<span class="qtext">... WHERE sql_cond</span>   <br><!-- /A -->
</P>
<p><span class="h4">
Effect
</span></p>
<p>
The <span class="qtext">WHERE</span> condition selects those nodes of the hierarchy specified after
<span class="qtext">SOURCE</span> that can be added to the results set of the hierarchy navigator. Columns of the hierarchy, including the additional
<a href="javascript:call_link('abenddddl_hierarchy.html')" class="blue">hierarchy columns</a>, can be used in the condition <a href="javascript:call_link('abenosql_expr_logexp.html')" class="blue"><span class="qtext">sql_cond</span></a>.
</p>
<p><span class="h4">
Note
</span></p>
<P>
Meeting the <span class="qtext">WHERE</span> condition is by itself not enough to add nodes to the results set. An ancestor node must also meet the <span class="qtext">START WHERE</span> in this case.
</P>
<br>
<br>
<!-- POSTFIX --><span class="h4">Continue</span><br>
<img src="exa.gif" alt="Example" title="Example">
<a href="javascript:call_link('abenhier_ancs_agg_abexa.html')" class="blue">Hierarchy Navigator HIERARCHY_ANCESTORS_AGGREGATE</a><br>
<br>
<br>
</DIV>
<fieldset style="opacity:0">
<input id="url" type="text" />
</fieldset>
</BODY>

<!-- Mirrored from help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abenselect_hierarchy_ancs_agg.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 Feb 2024 14:51:51 GMT -->
</html>
