<!doctype HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="EN">
<!-- ABENSQL_WIN_FUNC -->

<!-- Mirrored from help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abensql_win_func.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 Feb 2024 14:51:43 GMT -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="author" content="SAP">
<meta name="description" content="sql_exp - win_func">
<title>
sql_exp - win_func - ABAP Keyword Documentation
</title>
<link rel="icon" href="ABAPIcon.ico" type="image/ico">
<link rel="shortcut icon" href="ABAPIcon.ico">
<LINK rel="stylesheet" href="abap_docu.css" type="text/css">
<script language="javascript" type="text/javascript" src="functions.js"></script>
<script type="text/JavaScript">
function urlToClipboard(id){
 try{ var loc = top.location.href;}
 catch(e){ alert( "URL cannnot be determined" ); return; }
 var field = document.getElementById(id);
 field.focus();
 if ( loc.search( ".htm" ) == -1 && loc.search( ".HTM" ) == -1  ){ loc = loc + "index.htm"; }
 if (   loc.search( "index.html" ) != -1
     || loc.search( "INDEX-2.html" ) != -1 ){
   var off = loc.search( "file=" );
   if ( off == -1  ){
     field.value = loc + "?file=abensql_win_func.htm"; }
   else {
     field.value = loc.substring( 0, off ) + "file=abensql_win_func.htm";
   }
 }
 else {
    field.value = loc; }
 field.setSelectionRange(0, field.value.length);
 var r = confirm( "Copy URL to clipboard?\n\n" + field.value + "\n\nCopy to clipboard does not work in all browsers." );
 if (r == true) {
   try{
     document.execCommand("copy");
   }
     catch(e){ alert( "URL could not be copied to clipboard" ); }
 }
 window.scrollTo(0,0);
}
</script>
</head>
<body>
<div class="all">
<div style="float:right;">
<input type="button" value="URL"
style="font-size:10px; width:30px; height:18px; padding:0; "
onclick="urlToClipboard('url')" title="Copy URL to Clipboard" ></div>
<p>
<input name="query" id="query" value="" type="text" title="Suchbegriff" size="30" maxlength="30" onkeyup="getInput()">&nbsp;
<input type="button" value="Search"
style="font-size:12px; width:50px; height:18px; padding:0"
onclick="call_search('search.html')" title="Search in ABAP Keyword Documentation" >
<hr style="width:100%;height:1px"></p>
<p class="copyright">AS ABAP Release 754, &copy;Copyright 2019 SAP SE. All rights reserved.</p>
<span class="path">
<a href="javascript:call_link('abenabap.html')" class="blue">ABAP Keyword Documentation</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_reference.html')" class="blue">ABAP &#x2212; Reference</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_language_external_data.html')" class="blue">Processing External Data</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_sql.html')" class="blue">ABAP Database Access</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenopensql.html')" class="blue">ABAP SQL</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenopen_sql_operands.html')" class="blue">ABAP SQL - Operands and Expressions</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abapsql_expr.html')" class="blue">ABAP SQL - SQL Expressions sql_exp</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abapselect_over.html')" class="blue">sql_exp - sql_win</a>&nbsp;&rarr;&nbsp;
</span>
<A NAME="@@MAX@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@MIN@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@SUM@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@COUNT@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@ROW_NUMBER@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@RANK@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@DENSE_RANK@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@LEAD@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<A NAME="@@LAG@@!ABAP_OSQL_WIN_FUNC!@@"></A>
<p><span class="h1">
sql_exp - win_func <br><br>
</span></p>
<p><span class="h2">
<span class="bold">Syntax</span>
</span></p>
<P>
<span class="qtext">... <a href="javascript:call_link('abapselect_aggregate.html')" class="blue">AVG</a>(
<a href="javascript:call_link('abenopen_sql_columns.html')" class="blue">col</a> <i class=bn>[</i><a href="javascript:call_link('abapselect_avg_as.html')" class="blue">AS dtype</a><i class=bn>]</i> ) <br>
&nbsp;&nbsp;<i class=bn>|</i> <a href="javascript:call_link('abapselect_aggregate.html')" class="blue">MAX</a>( <a href="javascript:call_link('abapsql_expr.html')" class="blue">sql_exp</a> ) <br>
&nbsp;&nbsp;<i class=bn>|</i> <a href="javascript:call_link('abapselect_aggregate.html')" class="blue">MIN</a>( <a href="javascript:call_link('abapsql_expr.html')" class="blue">sql_exp</a> ) <br>
&nbsp;&nbsp;<i class=bn>|</i> <a href="javascript:call_link('abapselect_aggregate.html')" class="blue">SUM</a>( <a href="javascript:call_link('abapsql_expr.html')" class="blue">sql_exp</a> ) <br>
&nbsp;&nbsp;<i class=bn>|</i> <a href="javascript:call_link('abapselect_aggregate.html')" class="blue">COUNT</a>( <a href="javascript:call_link('abapsql_expr.html')" class="blue">sql_exp</a> ) <br>
&nbsp;&nbsp;<i class=bn>|</i> <a href="javascript:call_link('abapselect_aggregate.html')" class="blue">COUNT</a>( * ) <br>&nbsp;&nbsp;<i class=bn>|</i> <a href="javascript:call_link('abapselect_aggregate.html')" class="blue">COUNT</a>(*) <br>
 <br>&nbsp;&nbsp;<i class=bn>|</i> ROW_NUMBER( ) <br>&nbsp;&nbsp;<i class=bn>|</i> RANK( ) <br>&nbsp;&nbsp;<i class=bn>|</i> DENSE_RANK( ) <br>
 <br>&nbsp;&nbsp;<i class=bn>|</i> LEAD<i class=bn>|</i>LAG(
<a href="javascript:call_link('abapsql_expr.html')" class="blue">sql_exp1</a><i class=bn>[</i>, diff<i class=bn>[</i>, <a href="javascript:call_link('abapsql_expr.html')" class="blue">sql_exp2</a><i class=bn>]</i><i class=bn>]</i> ) ...</span> <br><br>
</P>
<p><span class="h2">
Variants:
</span></p>
<P>
   <A HREF="#!ABAP_VARIANT_1@1@" class="blue"> 1. <span class="qtext">... AVG( ... ) <i class=bn>|</i> ... <i class=bn>|</i> COUNT(*)</span> </A> <br>
<br><A HREF="#!ABAP_VARIANT_2@2@" class="blue"> 2. <span class="qtext">... ROW_NUMBER( )</span> </A> <br>
<br><A HREF="#!ABAP_VARIANT_3@3@" class="blue"> 3. <span class="qtext">... RANK(
)</span> </A> <br><br><A HREF="#!ABAP_VARIANT_4@4@" class="blue"> 4. <span class="qtext">... DENSE_RANK( )</span> </A> <br>
<br><A HREF="#!ABAP_VARIANT_5@5@" class="blue"> 5. <span class="qtext">... LEAD<i class=bn>|</i>LAG( sql_exp1<i class=bn>[</i>, diff<i class=bn>[</i>, sql_exp2<i class=bn>]</i><i class=bn>]</i> )</span> </A> <br><br>
</P>
<p><span class="h4">
Effect
</span></p>
<P>
<a href="javascript:call_link('abenwindow_function_glosry.html')" class="grey" title="Glossary Entry">Window function</a> in a <a href="javascript:call_link('abapselect_over.html')" class="blue">window expression</a>. Window functions are:
</P>
<ul class="disc">
<li>
<a href="javascript:call_link('abenaggregate_function_glosry.html')" class="grey" title="Glossary Entry">Aggregate functions</a> <span class="qtext">AVG( ... )</span>, ..., <span class="qtext">COUNT(*)</span> that can also be used in
<a href="javascript:call_link('abapselect_aggregate.html')" class="blue">aggregate expressions</a>.
<br><br></li>
<li>
<a href="javascript:call_link('abenranking_function_glosry.html')" class="grey" title="Glossary Entry">Ranking functions</a> <span class="qtext">ROW_NUMBER(
)</span>, <span class="qtext">RANK( )</span>, and <span class="qtext">DENSE_RANK( )</span> that can only be used in <a href="javascript:call_link('abapselect_over.html')" class="blue">window expressions</a>.
<br><br></li>
<li>
<a href="javascript:call_link('abenvalue_function_glosry.html')" class="grey" title="Glossary Entry">Value functions</a> <span class="qtext">LEAD( ... )</span>, <span class="qtext">LAG( ... )</span> that can be used only in
<a href="javascript:call_link('abapselect_over.html')" class="blue">window expressions</a>. <br><br>
<br></li>
</ul>
<p><span class="h2">
<A NAME="!ABAP_VARIANT_1@1@"></A> <span class="bold">Variant 1</span>
</span></p>
<P>
<span class="qtext">... AVG( ... ) <i class=bn>|</i> ... <i class=bn>|</i> COUNT(*)</span> <br><br><br><!-- /A -->
</P>
<p><span class="h4">
Effect
</span></p>
<P>
Specifies one of the aggregate functions <a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">MAX</span></a>,
<a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">MIN</span></a>, <a href="javascript:call_link('abensql_agg_func.html')" class="blue">
<span class="qtext">SUM</span></a>, <a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">COUNT</span></a>,
or <a href="javascript:call_link('abensql_agg_func.html')" class="blue"><span class="qtext">COUNT(*)</span></a> as a window function.
The aggregate functions evaluate the rows of the current window or of the frame defined by an addition
<span class="qtext">ORDER BY</span> after <a href="javascript:call_link('abapselect_over.html')" class="blue"><span class="qtext">OVER</span></a>. The aggregate functions are applied as in the
<a href="javascript:call_link('abensql_agg_func.html')" class="blue">general description</a>, with the following differences:
</P>
<ul class="disc">
<li>
The addition <span class="qtext">DISTINCT</span> is not allowed in a window expression.
<br><br></li>
<li>
The result of the function <span class="qtext">COUNT</span> has the data type INT8 and not INT4.
<br></li>
</ul>
<P>
The same applies to the arguments of aggregate functions as in the
<a href="javascript:call_link('abensql_agg_func.html')" class="blue">general description</a>, with the difference that the argument
of an aggregate function in a window expression can itself, as a window function, be an aggregate function.
This is the precise case when a grouping is made using the <a href="javascript:call_link('abapgroupby_clause.html')" class="blue"><span class="qtext">
GROUP BY</span></a> clause in the current query. The windows on the combined results set are then defined
and the aggregate expressions permitted as specified columns of the current <a href="javascript:call_link('abapselect_list.html')" class="blue">
<span class="qtext">SELECT</span> list</a> can be used either as standalone expressions or as part of
an SQL expression (as an argument of window functions of the window expressions in question). A window function then determines its result from the aggregated values of the rows of the current window.
</P>
<p><span class="h4">
Note
</span></p>
<P>
The addition <span class="qtext">DISTINCT</span> cannot be specified, which means that <span class="qtext">COUNT( sql_exp
)</span> can only be used to count rows that do not contain a null value and cannot be used to count rows with different results of <span class="qtext">sql_exp</span>.
</P>
<p><span class="h4">
Executable Example
</span></p>
<P>
<a href="javascript:call_link('abensql_expr_over_group_abexa.html')" class="blue">Window Expressions with Grouping</a> <br><br>
</P>
<p><span class="h2">
<A NAME="!ABAP_VARIANT_2@2@"></A> <span class="bold">Variant 2</span>
</span></p>
<P>
<span class="qtext">... ROW_NUMBER( )</span> <br><br><br><!-- /A -->
</P>
<p><span class="h4">
Effect
</span></p>
<P>
Specifies the ranking function <span class="qtext">ROW_NUMBER</span> as a window function. This ranking
function grants each row a row number of the data type INT8 and does not have an argument. The rows
of each window are numbered starting with 1. This numbering takes place in the order in which the rows
of a window are processed. The order is either undefined or can be defined by specifying the addition
<span class="qtext">ORDER BY</span> after <a href="javascript:call_link('abapselect_over.html')" class="blue"><span class="qtext">OVER</span></a>.
</P>
<p><span class="h4">
Note
</span></p>
<P>
If <span class="qtext">ORDER BY</span> is not specified after <a href="javascript:call_link('abapselect_over.html')" class="blue"><span class="qtext">
OVER</span></a>, <span class="qtext">ROW_NUMBER</span> still grants a unique row number, but these numbers are not ordered.
</P>
<p><span class="h4">
Executable Examples
</span></p>
<P>
<a href="javascript:call_link('abensql_expr_over_abexas.html')" class="blue">Examples of Window Expressions</a> <br><br>
</P>
<p><span class="h2">
<A NAME="!ABAP_VARIANT_3@3@"></A> <span class="bold">Variant 3</span>
</span></p>
<P>
<span class="qtext">... RANK( )</span> <br><br><br><!-- /A -->
</P>
<p><span class="h4">
Effect
</span></p>
<P>
Specifies the ranking function <span class="qtext">RANK</span> as a window function. This ranking function
grants each row a rank of the data type INT8 and does not have an argument. It can only be specified
together with <span class="qtext">ORDER BY</span> after <a href="javascript:call_link('abapselect_over.html')" class="blue"><span class="qtext">OVER</span></a>.
</P>
<P>
The rank of a row is the position of this row in the ranking defined by the addition <span class="qtext">ORDER BY</span> after <span class="qtext">OVER</span> and is defined as follows:
</P>
<ul class="disc">
<li>
All rows that occur more than once (with respect to the sort criterion) have the same rank. This rank is the lowest row number in this group, as determined by the function <span class="qtext">ROW_NUMBER</span>.
<br><br></li>
<li>
The first group of each window starts with the value 1.
<br></li>
</ul>
<p><span class="h4">
Note
</span></p>
<P>
If a window does not contain any multiple rows (with respect to the sort criterion), <span class="qtext">RANK</span>
produces the same result as <span class="qtext">ROW_NUMBER</span>. If any other cases, a ranking determined
by <span class="qtext">RANK</span> is not gap-free. <span class="qtext">DENSE_RANK</span> can be used to remove gaps.
</P>
<p><span class="h4">
Executable Example
</span></p>
<p>
<a href="javascript:call_link('abensql_expr_over_order_by_abexa.html')" class="blue">Window Expressions with Sort</a> <br><br>
</p>
<p><span class="h2">
<A NAME="!ABAP_VARIANT_4@4@"></A> <span class="bold">Variant 4</span>
</span></p>
<P>
<span class="qtext">... DENSE_RANK( )</span> <br><br><br><!-- /A -->
</P>
<p><span class="h4">
Effect
</span></p>
<P>
Specifies the ranking function <span class="qtext">DENSE_RANK</span> as a window function. This ranking
function grants each row a rank of the data type INT8 and does not have an argument. It can only be
specified together with <span class="qtext">ORDER BY</span> after <a href="javascript:call_link('abapselect_over.html')" class="blue"><span class="qtext">OVER</span></a>.
</P>
<P>
<span class="qtext">DENSE_RANK</span> works in largely the same way as <span class="qtext">RANK</span>,
but counts without any gaps, starting from the first group, and does not determine the rank using the lowest row number of groups of identical values (with respect to the sort criterion).
</P>
<p><span class="h4">
Note
</span></p>
<P>
If a window does not contain any multiple rows (with respect to the sort criterion), <span class="qtext">DENSE_RANK</span> produces the same result as <span class="qtext">RANK</span>.
</P>
<p><span class="h4">
Executable Example
</span></p>
<p>
<a href="javascript:call_link('abensql_expr_over_order_by_abexa.html')" class="blue">Window Expressions with Sort</a> <br><br>
</p>
<p><span class="h2">
<A NAME="!ABAP_VARIANT_5@5@"></A> <span class="bold">Variant 5</span>
</span></p>
<P>
<span class="qtext">... LEAD<i class=bn>|</i>LAG( sql_exp1<i class=bn>[</i>, diff<i class=bn>[</i>, sql_exp2<i class=bn>]</i><i class=bn>]</i></span> <br><br><br><!-- /A -->
</P>
<p><span class="h4">
Effect
</span></p>
<P>
Specifies the value functions <span class="qtext">LEAD</span> or <span class="qtext">LAG</span> as a
window function. They can only be specified together with <span class="qtext">ORDER BY</span> after <a href="javascript:call_link('abapselect_over.html')" class="blue"><span class="qtext">OVER</span></a>.
</P>
<P>
The result of the functions is the value of the SQL expression <a href="javascript:call_link('abapsql_expr.html')" class="blue"><span class="qtext">
sql_exp1</span></a> for the row of the current window or for the row of the box defined by an addition
<span class="qtext">ORDER BY</span> after <a href="javascript:call_link('abapselect_over.html')" class="blue"><span class="qtext">OVER</span></a>.
This row is itself defined by the addition <span class="qtext">diff</span>. <span class="qtext">diff</span> can be specified as a
<a href="javascript:call_link('abenabap_sql_host_literals.html')" class="blue">literal</a> or a
<a href="javascript:call_link('abenopen_sql_host_variables.html')" class="blue">host constant</a> with the ABAP type <span class="qtext">b</span>,
<span class="qtext">s</span>, <span class="qtext">i</span>, <span class="qtext">int8</span>, whose value is a positive number other than 0.
</P>
<ul class="disc">
<li>
For the function <span class="qtext">LEAD</span>, <span class="qtext">diff</span> determines the row positioned the distance in question after the current row.
<br><br></li>
<li>
For the function <span class="qtext">LAG</span>, <span class="qtext">diff</span> determines the row positioned the distance in question in front of the current row.
<br></li>
</ul>
<P>
If <span class="qtext">diff</span> is not specified, the value 1 is used. In the case of <span class="qtext">LEAD</span>,
this is the row that follows directly and in the case of <span class="qtext">LAG</span>, the directly preceding row. If the row determined by <span class="qtext">diff</span> is not in the current window, the result is the
<a href="javascript:call_link('abennull_value_glosry.html')" class="grey" title="Glossary Entry">null value</a> by default. If
the optional SQL expression <a href="javascript:call_link('abapsql_expr.html')" class="blue"><span class="qtext">sql_exp2</span></a> is specified, it is evaluated and returned as the current row in cases where the row does not exist.
</P>
<P>
The result of the functions <span class="qtext">LEAD</span> and <span class="qtext">LAG</span> has the following data type:
</P>
<ul class="disc">
<li>
If <a href="javascript:call_link('abapsql_expr.html')" class="blue"><span class="qtext">sql_exp2</span></a>
is not specified, the data type is determined by <a href="javascript:call_link('abapsql_expr.html')" class="blue"><span class="qtext">sql_exp1</span></a>.
<br><br></li>
<li>
If <a href="javascript:call_link('abapsql_expr.html')" class="blue"><span class="qtext">sql_exp2</span></a> is specified, the
results of <span class="qtext">sql_exp1</span> and <span class="qtext">sql_exp2</span> must match in
a way that a common result type can be determined: The data types must either be the same or the data
type of one expression must represent the value of the other expression. The result has the dictionary type of the expression with the largest value range.
<br></li>
</ul>
<p><span class="h4">
Notes
</span></p>
<ul class="disc">
<li>
The window functions <span class="qtext">LEAD</span> or <span class="qtext">LAG</span> are suited to
calculations such as, for example, determining the difference between values in the current row and values of the preceding or following rows.
<br><br></li>
<li>
If the window functions <span class="qtext">LEAD</span> or <span class="qtext">LAG</span> are used, the syntax check is applied in <a href="javascript:call_link('abenopensql_strict_mode_754.html')" class="blue">strict mode from Release 7.54</a>.
<br></li>
</ul>
<p><span class="h4">
Example
</span></p>
<p>
<span class="qtext">SELECT</span> statement with the window functions <span class="qtext">LEAD</span> and <span class="qtext">LAG</span> as operands of an
<a href="javascript:call_link('abensql_arith.html')" class="blue">arithmetic expression</a>. The addition <a href="javascript:call_link('abapselect_over.html')" class="blue">
<span class="qtext">PARTITION</span></a> is not specified, which means there is only one window containing
all rows of the results set. Both <span class="qtext">LEAD</span> and <span class="qtext">LAG</span>
have only one argument each, which means that the difference between the values of the column NUM1 is calculated using the directly following or preceding row, and any nonexistent rows produce null values. These values are defined using a
<a href="javascript:call_link('abennull_indicator_glosry.html')" class="grey" title="Glossary Entry">null indicator</a>. The
program <span class="lnkgrey">DEMO_SELECT_OVER_LEAD_LAG_DIFF</span> uses this <span class="qtext">SELECT</span> statement and, when <span class="lnkgrey">executed</span>, the program displays the result.
</p>
<p class="qtextml1">
<span class="qtext">
SELECT num1 AS number, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num1 - LEAD( num1 ) OVER( ORDER BY id ) AS diff_lead, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; num1 - LAG(&nbsp;&nbsp;num1 ) OVER( ORDER BY id ) AS diff_lag <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM demo_expressions <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORDER BY id <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INTO TABLE @DATA(lead_lag_diffs) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INDICATORS NULL STRUCTURE null_ind.
</span>
</p>
<p><span class="h4">
Executable Example
</span></p>
<p>
<a href="javascript:call_link('abensql_expr_over_lead_lag_abexa.html')" class="blue">Window Functions <span class="qtext">LEAD</span> and <span class="qtext">LAG</span></a>
</p>
<br>
<br>
<br>
<br>
</DIV>
<fieldset style="opacity:0">
<input id="url" type="text" />
</fieldset>
</BODY>

<!-- Mirrored from help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abensql_win_func.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 Feb 2024 14:51:43 GMT -->
</html>
