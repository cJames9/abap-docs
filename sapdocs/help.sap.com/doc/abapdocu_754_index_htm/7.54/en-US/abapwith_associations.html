<!doctype HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="EN">
<!-- ABAPWITH_ASSOCIATIONS -->

<!-- Mirrored from help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abapwith_associations.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 Feb 2024 14:51:34 GMT -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="author" content="SAP">
<meta name="description" content="WITH - ASSOCIATIONS">
<title>
WITH - ASSOCIATIONS - ABAP Keyword Documentation
</title>
<link rel="icon" href="ABAPIcon.ico" type="image/ico">
<link rel="shortcut icon" href="ABAPIcon.ico">
<LINK rel="stylesheet" href="abap_docu.css" type="text/css">
<script language="javascript" type="text/javascript" src="functions.js"></script>
<script type="text/JavaScript">
function urlToClipboard(id){
 try{ var loc = top.location.href;}
 catch(e){ alert( "URL cannnot be determined" ); return; }
 var field = document.getElementById(id);
 field.focus();
 if ( loc.search( ".htm" ) == -1 && loc.search( ".HTM" ) == -1  ){ loc = loc + "index.htm"; }
 if (   loc.search( "index.html" ) != -1
     || loc.search( "INDEX-2.html" ) != -1 ){
   var off = loc.search( "file=" );
   if ( off == -1  ){
     field.value = loc + "?file=abapwith_associations.htm"; }
   else {
     field.value = loc.substring( 0, off ) + "file=abapwith_associations.htm";
   }
 }
 else {
    field.value = loc; }
 field.setSelectionRange(0, field.value.length);
 var r = confirm( "Copy URL to clipboard?\n\n" + field.value + "\n\nCopy to clipboard does not work in all browsers." );
 if (r == true) {
   try{
     document.execCommand("copy");
   }
     catch(e){ alert( "URL could not be copied to clipboard" ); }
 }
 window.scrollTo(0,0);
}
</script>
</head>
<body>
<div class="all">
<div style="float:right;">
<input type="button" value="URL"
style="font-size:10px; width:30px; height:18px; padding:0; "
onclick="urlToClipboard('url')" title="Copy URL to Clipboard" ></div>
<p>
<input name="query" id="query" value="" type="text" title="Suchbegriff" size="30" maxlength="30" onkeyup="getInput()">&nbsp;
<input type="button" value="Search"
style="font-size:12px; width:50px; height:18px; padding:0"
onclick="call_search('search.html')" title="Search in ABAP Keyword Documentation" >
<hr style="width:100%;height:1px"></p>
<p class="copyright">AS ABAP Release 754, &copy;Copyright 2019 SAP SE. All rights reserved.</p>
<span class="path">
<a href="javascript:call_link('abenabap.html')" class="blue">ABAP Keyword Documentation</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_reference.html')" class="blue">ABAP &#x2212; Reference</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_language_external_data.html')" class="blue">Processing External Data</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenabap_sql.html')" class="blue">ABAP Database Access</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenopensql.html')" class="blue">ABAP SQL</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abenopen_sql_reading.html')" class="blue">ABAP SQL - Reads</a>&nbsp;&rarr;&nbsp;
<a href="javascript:call_link('abapwith.html')" class="blue">WITH</a>&nbsp;&rarr;&nbsp;
</span>
<A NAME="@@AS@@WITH ASSOCIATIONS@@"></A>
<A NAME="@@WITH ASSOCIATIONS ( ... )@@WITH@@"></A>
<p><span class="h1">
WITH - ASSOCIATIONS
</span></p>
<A name="@@ITOC@@ABAPWITH_ASSOCIATIONS_1"></A>
<p><span class="h2">
Syntax
</span></p>
<p>
<span class="qtext">... WITH ASSOCIATIONS ( <a href="javascript:call_link('abapwith_associations_using.html')" class="blue">path</a> <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; <i class=bn>|</i><a href="javascript:call_link('abapwith_associations_defining.html')" class="blue">join</a><i class=bn>[</i>, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<i class=bn>]</i> ) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i class=bn>|</i>(assoc_syntax)</span> <br><br>
</p>
<p><span class="h4">
Effect
</span></p>
<P>
The addition <span class="qtext">WITH ASSOCIATIONS</span> used to define a common table expression publishes
associations of this table expression for use in the subsequent queries of a <a href="javascript:call_link('abapwith.html')" class="blue"><span class="qtext">WITH</span></a> statement. The following can be specified:
</P>
<ul class="disc">
<li>
Existing <a href="javascript:call_link('abencds_association_glosry.html')" class="grey" title="Glossary Entry">CDS associations</a> or
<a href="javascript:call_link('abencte_association_glosry.html')" class="grey" title="Glossary Entry">CTE associations</a> of the common table expression using
<a href="javascript:call_link('abencds_path_expression_glosry.html')" class="grey" title="Glossary Entry">SQL path expressions</a> <a href="javascript:call_link('abapwith_associations_using.html')" class="blue"><span class="qtext">path</span></a>.
<br><br></li>
<li>
Definitions of new <a href="javascript:call_link('abencte_association_glosry.html')" class="grey" title="Glossary Entry">CTE
associations</a> of the common table expression using <a href="javascript:call_link('abapwith_associations_defining.html')" class="blue"><span class="qtext">join</span></a>.
<br></li>
</ul>
<P>
The parentheses must contain at least one association and multiple associations can be specified as a comma-separated list. Both existing and new associations can be specified together and in any order.
</P>
<ul class="disc">
<li>
In subsequent queries of the current WITH statement, the published associations can be used as root elements of the path expressions in question.
<br></li>
</ul>
<ul class="circlem2">
<li>In the <a href="javascript:call_link('abenopen_sql_columns.html')" class="blue">specified columns</a> of <span class="qtext">SELECT</span> statements of the subsequent queries.</li>
</ul>
<ul class="circlem2">
<li>As a <a href="javascript:call_link('abapselect_data_source.html')" class="blue">data source</a> of the <a href="javascript:call_link('abapfrom_clause.html')" class="blue"><span class="qtext">FROM</span> clause</a> of the subsequent queries.</li>
</ul>
<ul class="disc">
<li>
Published <a href="javascript:call_link('abenself_association_glosry.html')" class="grey" title="Glossary Entry">self associations</a> can be specified in the
<a href="javascript:call_link('abenhierarchy_generator_glosry.html')" class="grey" title="Glossary Entry">hierarchy
generator</a> <a href="javascript:call_link('abenselect_hierarchy_generator.html')" class="blue"><span class="qtext">HIERARCHY</span></a> as a
<a href="javascript:call_link('abenhierarchy_association_glosry.html')" class="grey" title="Glossary Entry">hierarchy association</a>.
<br><br></li>
<li>
A published association can be published again by a subsequent common table expression of the current
<span class="qtext">WITH</span> statement using the addition <span class="qtext">WITH ASSOCIATIONS</span>, as long as this addition uses the publisher table expression as a data source. Different
<a href="javascript:call_link('abenopen_sql_path_filter.html')" class="blue">attributes</a> can be specified here.
<br></li>
</ul>
<P>
Instead of specifying associations statically in parentheses, a parenthesized data object <span class="qtext">assoc_syntax</span>
can be specified. When the statement is executed, the data object must contain the syntax displayed
for the statically specified information. In this case, the common table expression can be used only
in other dynamic tokens of the <span class="qtext">WITH</span> statement. The data object <span class="qtext">assoc_syntax</span> can be a character-like data object or a
<a href="javascript:call_link('abenstandard_table_glosry.html')" class="grey" title="Glossary Entry">standard table</a> with
a character-like row type. The syntax in <span class="qtext">assoc_syntax</span>, as in the static syntax,
is not case-sensitive. When an internal table is specified, the syntax can span multiple rows. Invalid syntax raises a handleable exception from the class CX_SY_DYNAMIC_OSQL_ERROR.
</P>
<P>
If an association is published more than once under different alias names, it as handled as a separate
association when used in a path expression. A separate instance of a join expression is created for
each association used and each expression uses the results set of the publisher common table expression as its left side.
</P>
<P>
The addition <span class="qtext">WITH ASSOCIATIONS</span> cannot be used if the subquery of the common
table expression contains the language element <a href="javascript:call_link('abapunion.html')" class="blue"><span class="qtext">UNION</span></a>.
As before, it is not possible to use the addition <a href="javascript:call_link('abapselect_client.html')" class="blue"><span class="qtext">
USING</span></a> or or the obsolete addition <a href="javascript:call_link('abapselect_client_obsolete.html')" class="blue"><span class="qtext">
CLIENT SPECIFIED</span></a> in the current CTE, nor in CTEs where the addition <span class="qtext">REDIRECTED
TO</span> is applied, nor in queries that use the association in a path expression and that transform it to a join expression.
</P>
<p><span class="h4">
Notes
</span></p>
<ul class="disc">
<li>
When an association of the data source of a common table expression is published using <span class="qtext">WITH ASSOCIATION</span>, this is the same as
<a href="javascript:call_link('abencds_f1_select_list_association.html')" class="blue">publishing</a> an association of the data source of a CDS view in its <span class="qtext400">SELECT</span> list.
<br><br></li>
<li>
It should be noted that the publisher common table expression itself is the source data source of the
published association and not the data source of the expression. The publisher common table expression
replaces the original source data source of the association. The left side of an instance of a join expression created for the published association is the results set of the subquery of the common table expression.
<br></li>
</ul>
<p><span class="h4">
Example
</span></p>
<P>
The following example program <span class="lnkgrey">DEMO_WITH_ASSOCIATIONS</span> demonstrates how CDS associations are published by common table expressions. It works in the same way as the
<a href="javascript:call_link('abenpath_expr_in_from_clause_abexa.html')" class="blue">executable example</a> for using path
expressions in the <span class="qtext">FROM</span> clause. The main query uses the alias name <span class="qtext">
_spfli_scarr</span> to access the target data source SCARR of the final CDS association <span class="qtext">_scarr</span>
of the path expression <span class="qtext">\_spfli[ fltime > @fltime ]\_scarr</span> published for the
common table expression <span class="qtext400">+cte</span>. The <span class="qtext">SELECT</span> list
of the common table expression must specify the component <span class="qtext">\_spfli-carrid</span>
with the same filter condition <span class="qtext">fltime > @fltime</span> as in the published association. This ensures that an instance of the associated join can be created.
</P>
<p class="qtextml1">
<span class="qtext">
DATA: <br>&nbsp;&nbsp;tz&nbsp;&nbsp;&nbsp;&nbsp; TYPE s_tzone&nbsp;&nbsp;&nbsp;&nbsp;VALUE 'UTC+1', <br>
&nbsp;&nbsp;currc&nbsp;&nbsp;TYPE s_currcode VALUE 'EUR', <br>&nbsp;&nbsp;fltime TYPE s_fltime&nbsp;&nbsp; VALUE 0. <br>
 <br>cl_demo_input=>new( <br>&nbsp;&nbsp;)->add_field( CHANGING field = tz <br>&nbsp;&nbsp;)->add_field( CHANGING field = currc <br>
&nbsp;&nbsp;)->add_field( CHANGING field = fltime )->request( ). <br> <br>WITH <br>&nbsp;&nbsp;+cte AS ( SELECT \_spfli[ fltime > @fltime ]-carrid <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM demo_cds_assoc_sairport_tz( <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tz = @( to_upper( tz ) ) ) ) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WITH ASSOCIATIONS ( \_spfli[ fltime > @fltime ] <br>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \_scarr AS _spfli_scarr ) <br>
&nbsp;&nbsp;SELECT DISTINCT carrname <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM +cte\_spfli_scarr[ <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currcode = @( CONV s_currcode( to_upper( currc ) ) ) ] <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS scarr <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ORDER BY carrname <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INTO TABLE @DATA(result). <br> <br>cl_demo_output=>display( result ).
</span>
</p>
<br>
<br>
<!-- POSTFIX --><span class="h4">Continue</span><br>
<a href="javascript:call_link('abapwith_associations_using.html')" class="blue">WITH - ASSOCIATIONS, path</a><br>
<a href="javascript:call_link('abapwith_associations_defining.html')" class="blue">WITH - ASSOCIATIONS, JOIN</a><br>
<br>
<br>
</DIV>
<fieldset style="opacity:0">
<input id="url" type="text" />
</fieldset>
</BODY>

<!-- Mirrored from help.sap.com/doc/abapdocu_754_index_htm/7.54/en-US/abapwith_associations.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 18 Feb 2024 14:51:34 GMT -->
</html>
